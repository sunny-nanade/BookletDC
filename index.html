<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booklet Scanner</title>
    
    <!-- External CSS Files -->
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/camera.css">
    <link rel="stylesheet" href="/static/css/controls.css">
    <link rel="stylesheet" href="/static/css/preview.css">
    <link rel="stylesheet" href="/static/css/ui-components.css">
</head>
<body>
    <!-- Loading overlay -->
    <div id="loading-overlay">
        <div>
            <div>üìπ</div>
            <div id="loading-text">Initializing Camera System...</div>
            <div id="loading-subtext">Please wait while we set up your cameras</div>
        </div>
    </div>
    
    <div class="container">
        <section class="top-section">
            <div class="content">
                <div class="header-container">
                    <div class="qr-display left-qr">
                        <span class="qr-label">Left QR:</span>
                        <span class="qr-value" id="left-qr-value">Not detected</span>
                    </div>
                    <h1>Booklet Scanner <span class="settings-status-inline" id="settings-status" title="Settings synced with server">
                        <span class="status-indicator synced" id="status-indicator">‚óè</span>
                        <span class="status-text" id="status-text">(Synced)</span>
                    </span></h1>
                    <div class="qr-display right-qr">
                        <span class="qr-label">Right QR:</span>
                        <span class="qr-value" id="right-qr-value">Not detected</span>
                        <div class="scanner-gun-indicator" id="scanner-gun-indicator">
                            <span class="scanner-icon">üî´</span>
                            <span class="scanner-status" id="scanner-gun-status">Ready</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="bottom-section">
            <div class="camera-preview-area">
                <div class="camera-container">
                    <div class="camera-preview left-camera">
                        <div class="camera-placeholder">Left Camera</div>
                        <div class="camera-info-overlay" id="left-camera-info" style="display: none;">
                            <div class="resolution-info">720p</div>
                        </div>
                    </div>
                    <div class="camera-preview right-camera">
                        <div class="camera-placeholder">Right Camera</div>
                        <div class="camera-info-overlay" id="right-camera-info" style="display: none;">
                            <div class="resolution-info">720p</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="camera-configuration-area">
                <h3>Scanner Control Panel</h3>
                <div class="config-controls">
                    <div class="control-panel-upper">
                        <div class="control-section">
                            <h4>Booklet</h4>
                            <div class="control-group">
                                <div class="group-label">Main Answersheet Pages</div>
                                <div class="pages-dropdown-container">
                                    <select class="pages-dropdown" id="main-pages-select" name="main-pages">
                                        <option value="2">2</option>
                                        <option value="4">4</option>
                                        <option value="6">6</option>
                                        <option value="8">8</option>
                                        <option value="10">10</option>
                                        <option value="12">12</option>
                                        <option value="14">14</option>
                                        <option value="16">16</option>
                                        <option value="18">18</option>
                                        <option value="20">20</option>
                                        <option value="22">22</option>
                                        <option value="24">24</option>
                                        <option value="26">26</option>
                                        <option value="28">28</option>
                                        <option value="30">30</option>
                                        <option value="32" selected>32</option>
                                        <option value="34">34</option>
                                        <option value="36">36</option>
                                        <option value="38">38</option>
                                        <option value="40">40</option>
                                        <option value="42">42</option>
                                        <option value="44">44</option>
                                        <option value="46">46</option>
                                        <option value="48">48</option>
                                        <option value="50">50</option>
                                        <option value="52">52</option>
                                        <option value="54">54</option>
                                        <option value="56">56</option>
                                        <option value="58">58</option>
                                        <option value="60">60</option>
                                        <option value="62">62</option>
                                        <option value="64">64</option>
                                        <option value="66">66</option>
                                        <option value="68">68</option>
                                        <option value="70">70</option>
                                        <option value="72">72</option>
                                        <option value="74">74</option>
                                        <option value="76">76</option>
                                        <option value="78">78</option>
                                        <option value="80">80</option>
                                        <option value="82">82</option>
                                        <option value="84">84</option>
                                        <option value="86">86</option>
                                        <option value="88">88</option>
                                        <option value="90">90</option>
                                        <option value="92">92</option>
                                        <option value="94">94</option>
                                        <option value="96">96</option>
                                        <option value="98">98</option>
                                        <option value="100">100</option>
                                    </select>
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="group-label">Supplement Count</div>
                                <div class="supplement-radio-group">
                                    <div class="supplement-row">
                                        <div class="radio-option">
                                            <input type="radio" id="supp-0" name="supplement-count" value="0" checked>
                                            <label for="supp-0" class="radio-button">0</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="supp-1" name="supplement-count" value="1">
                                            <label for="supp-1" class="radio-button">1</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="supp-2" name="supplement-count" value="2">
                                            <label for="supp-2" class="radio-button">2</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="supp-3" name="supplement-count" value="3">
                                            <label for="supp-3" class="radio-button">3</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="supp-4" name="supplement-count" value="4">
                                            <label for="supp-4" class="radio-button">4</label>
                                        </div>
                                    </div>
                                    <div class="supplement-row">
                                        <div class="radio-option">
                                            <input type="radio" id="supp-5" name="supplement-count" value="5">
                                            <label for="supp-5" class="radio-button">5</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="supp-6" name="supplement-count" value="6">
                                            <label for="supp-6" class="radio-button">6</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="supp-7" name="supplement-count" value="7">
                                            <label for="supp-7" class="radio-button">7</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="supp-8" name="supplement-count" value="8">
                                            <label for="supp-8" class="radio-button">8</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="supp-9" name="supplement-count" value="9">
                                            <label for="supp-9" class="radio-button">9</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-section">
                            <h4>Page Trim</h4>
                            <div class="trim-container">
                                <div class="trim-section">
                                    <div class="trim-label">Left Trim (%)</div>
                                    <div class="trim-inputs">
                                        <div class="trim-input-group">
                                            <div class="trim-input-label">Top</div>
                                            <input type="number" class="trim-input" id="left-top" name="left-top" min="0" max="50" step="0.1" value="0" placeholder="0%">
                                        </div>
                                        <div class="trim-input-group">
                                            <div class="trim-input-label">Bottom</div>
                                            <input type="number" class="trim-input" id="left-bottom" name="left-bottom" min="0" max="50" step="0.1" value="0" placeholder="0%">
                                        </div>
                                        <div class="trim-input-group">
                                            <div class="trim-input-label">Left</div>
                                            <input type="number" class="trim-input" id="left-left" name="left-left" min="0" max="50" step="0.1" value="0" placeholder="0%">
                                        </div>
                                        <div class="trim-input-group">
                                            <div class="trim-input-label">Right</div>
                                            <input type="number" class="trim-input" id="left-right" name="left-right" min="0" max="50" step="0.1" value="0" placeholder="0%">
                                        </div>
                                    </div>
                                </div>
                                <div class="trim-section">
                                    <div class="trim-label">Right Trim (%)</div>
                                    <div class="trim-inputs">
                                        <div class="trim-input-group">
                                            <div class="trim-input-label">Top</div>
                                            <input type="number" class="trim-input" id="right-top" name="right-top" min="0" max="50" step="0.1" value="0" placeholder="0%">
                                        </div>
                                        <div class="trim-input-group">
                                            <div class="trim-input-label">Bottom</div>
                                            <input type="number" class="trim-input" id="right-bottom" name="right-bottom" min="0" max="50" step="0.1" value="0" placeholder="0%">
                                        </div>
                                        <div class="trim-input-group">
                                            <div class="trim-input-label">Left</div>
                                            <input type="number" class="trim-input" id="right-left" name="right-left" min="0" max="50" step="0.1" value="0" placeholder="0%">
                                        </div>
                                        <div class="trim-input-group">
                                            <div class="trim-input-label">Right</div>
                                            <input type="number" class="trim-input" id="right-right" name="right-right" min="0" max="50" step="0.1" value="0" placeholder="0%">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-section">
                            <h4 id="camera-config-title" style="cursor: pointer; transition: color 0.3s ease;" title="Click to configure cameras">Camera Configuration</h4>
                            <div class="camera-config-container">
                                <div class="camera-config-section">
                                    <div class="camera-config-label">Left Camera</div>
                                    <div class="camera-config-controls">
                                        <div class="config-control-group">
                                            <div class="config-control-label">Device</div>
                                            <select class="config-select" id="left-camera-device" name="left-camera-device">
                                                <option value="">Select</option>
                                            </select>
                                        </div>
                                        <div class="config-control-group">
                                            <div class="config-control-label">Resolution</div>
                                            <select class="config-select" id="left-camera-resolution" name="left-camera-resolution">
                                                <option value="720p">720p</option>
                                                <option value="1080p">1080p</option>
                                                <option value="1440p" selected>1440p</option>
                                                <option value="4K">4K</option>
                                                <option value="custom-high">1955√ó1450 (High QR)</option>
                                            </select>
                                        </div>
                                        <div class="config-control-group">
                                            <div class="config-control-label">Rotate</div>
                                            <select class="config-select" id="left-camera-rotate" name="left-camera-rotate">
                                                <option value="0">0¬∞</option>
                                                <option value="90">90¬∞</option>
                                                <option value="180">180¬∞</option>
                                                <option value="270">270¬∞</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="camera-config-section">
                                    <div class="camera-config-label">Right Camera</div>
                                    <div class="camera-config-controls">
                                        <div class="config-control-group">
                                            <div class="config-control-label">Device</div>
                                            <select class="config-select" id="right-camera-device" name="right-camera-device">
                                                <option value="">Select</option>
                                            </select>
                                        </div>
                                        <div class="config-control-group">
                                            <div class="config-control-label">Resolution</div>
                                            <select class="config-select" id="right-camera-resolution" name="right-camera-resolution">
                                                <option value="720p">720p</option>
                                                <option value="1080p">1080p</option>
                                                <option value="1440p" selected>1440p</option>
                                                <option value="4K">4K</option>
                                                <option value="custom-high">1955√ó1450 (High QR)</option>
                                            </select>
                                        </div>
                                        <div class="config-control-group">
                                            <div class="config-control-label">Rotate</div>
                                            <select class="config-select" id="right-camera-rotate" name="right-camera-rotate">
                                                <option value="0">0¬∞</option>
                                                <option value="90">90¬∞</option>
                                                <option value="180">180¬∞</option>
                                                <option value="270">270¬∞</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="preview-pages-section">
                    <div class="preview-header-center" style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 8px;">
                    <h4 style="margin: 0;">Preview Pages</h4>
                    <button class="retake-button" id="retake-button" disabled style="margin-left: 12px; font-size: 0.95rem; padding: 5px 14px;">Retake</button>
                    </div>
                    <div class="preview-content" id="preview-content">
                    <!-- Current Spread Section -->
                    <div class="current-spread-section">
                    <div class="current-spread-display" id="current-spread-display">
                    <div class="page-thumbnail" id="current-left-page">
                    <span>No Image</span>
                    </div>
                    <div class="page-thumbnail" id="current-right-page">
                    <span>No Image</span>
                    </div>
                    </div>
                    </div>
                    <div class="spread-selector" id="spread-selector"></div>
                    <!-- No spreads message (initially hidden) -->
                    <div class="no-spreads-message" id="no-spreads-message" style="display: none;">
                    <span id="no-spreads-text">No spreads captured yet. Press Space to start scanning.</span>
                    </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    
    <!-- External JavaScript Files -->
    <!-- QR Detection Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <!-- PDF Generation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- OpenCV.js for advanced image processing -->
    <script async src="https://docs.opencv.org/4.x/opencv.js" type="text/javascript"></script>
    <script src="/static/js/qr-detector.js"></script>
    <script src="/static/js/opencv-preview-manager.js"></script>
    <script src="/static/js/settings-manager.js"></script>
    <script src="/static/js/camera-manager.js"></script>
    <script src="/static/js/image-capture-manager.js"></script>
    <script src="/static/js/spread-manager.js"></script>
    <script src="/static/js/pdf-generator.js"></script>
    <script src="/static/js/main.js"></script>
</body>
</html>
